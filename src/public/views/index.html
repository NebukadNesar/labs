<html>
<head>
  <title>Lab management tool</title>
  <script src="client/static/libs/jquery-min.js"></script>
  <script src="client/static/libs/bootstrap.min.js"></script>
  <link rel="stylesheet" href="client/static/libs/bootstrap.min.css">
  <link rel="stylesheet" href="client/static/libs/fileupload.css">
  <link rel="stylesheet" href="client/static/libs/bootstrap-theme.min.css">
  <link rel="stylesheet" href="client/static/libs/materialize.min.css">

  <script type="text/javascript">
  $(document).ready(function() {

    var availableServerData = false;
    var serverList = [];

    function closeall (){
      $("#labm_about").hide();
      $("#labm_home").hide();
      $("#labm_sitemap").hide();
      $(".lili").removeClass("active");
    }

    function readFileContent(){
      try {
        var content = $.parseJSON($("#content").val().trim());
        console.log(content);
        $.ajax({
          type: 'POST',
          data: JSON.stringify(content),
          contentType: 'application/json',
          url: 'http://localhost:3000/api/upload',
          success: function(data) {
            console.log('success');
            console.log(JSON.stringify(data));
          },
          failure: (result) =>{
            console.log(result);
          }
        });
      } catch (e) {
        $("#error-messagge").html("Content json formatında değil..")
      } finally {

      }
    }

    function populateTable(args, refreshh){
      if(availableServerData==true && refreshh==false){
        return;
      }
      var data = args.serverList;
      var table = document.getElementsByClassName("rwd-table")[0];
      availableServerData = true;
      serverList = data;

      // Create an empty <tr> element and add it to the 1st position of the table:
      for (var i = 0; i < data.length; i++) {
        var rowIndex = 0;
        if(table.rows){
          rowIndex = table.rows.length;
        }
        var row = table.insertRow(rowIndex);

        // Insert new cells (<td> elements) at the 1st and 2nd position of the "new" <tr> element:
        var cell0 = row.insertCell(0);
        var cell1 = row.insertCell(1);
        var cell2 = row.insertCell(2);
        var cell3 = row.insertCell(3);
        var cell4 = row.insertCell(4);
        var cell5 = row.insertCell(5);
        var cell6 = row.insertCell(6);
        var cell7 = row.insertCell(7);
        var cell8 = row.insertCell(8);

        // Add some text to the new cells:
        cell0.innerHTML = data[i].serverName || "-";
        cell1.innerHTML = data[i].serverLocation || "-";
        cell2.innerHTML = data[i].serverIp || "-";
        cell3.innerHTML = data[i].serialNumber || "-";
        cell4.innerHTML = data[i].relatedGroup || "-";
        cell5.innerHTML = data[i].relatedProject || "-";
        cell6.innerHTML = data[i].serverEndDate || "-";
        cell7.innerHTML = data[i].serverAdmin || "-";
        cell8.innerHTML = data[i].serverPasswd || "-";
      }

    }

    /**find server with ip **/
    function findServer(ip){
      var servers;
      if(serverList.length !== 0){
        servers = serverList;
      }
      else{
        getAllServers();
      }
      for (var i = 0; i < servers.length; i++){
        if(servers[i].serverIp === ip){
          return servers[i];
        }
      }
      return null;
    }

    function getAllServers(args){
      if(availableServerData==true && args !== "refreshh"){
        return;
      }
      $.ajax({
        type: 'GET',
        contentType: 'application/json',
        url: 'http://localhost:3000/api/getAllServers',
        success: function(data) {
          console.log('success');
          console.log(data);
          populateTable(data, true);
        },
        failure: (result) =>{
          console.log(result);
        }
      });
    }

    function refreshhServers(){
      var elmtTable = document.getElementsByClassName("rwd-table")[0];
      var rowCount = elmtTable.rows.length;
      while(--rowCount) elmtTable.deleteRow(rowCount);
      getAllServers("refreshh");
    }

    $('#upload').click(function() {
      $.get('http://localhost/api/upload', function(result) {

      });
    });
    $('#li_home').click(function() {
      closeall();
      $("#li_home").addClass("active");
      $("#labm_home").show()
    });

    $('#li_about').click(function() {
      closeall();
      getAllServers("about");
      $("#li_about").addClass("active");
      $("#labm_about").show()
    });

    $('#li_refreshh').click(function() {
      refreshhServers();
    });


    $('#li_sitemap').click(function() {
      closeall();
      $("#li_sitemap").addClass("active");
      $("#labm_sitemap").show()
    });
    $('#uploadfile').click(function() {
      readFileContent();
    });

  });
  </script>
</head>
<body>
  <div style="margin:100px;">

    <nav style="background:darkgreen;">
      <div class="nav-wrapper">
        <a href="#" class="brand-logo">Labs</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
          <li class="lili" id="li_home">
            <a href="#" >Home</a>
          </li>
          <li class="lili" id="li_about">
            <a href="#">Labs</a>
          </li>
          <li class="lili" id="li_sitemap">
            <a href="#">About</a>
          </li>
        </ul>
      </div>
    </nav>

    <div id="labm_home"  class="jumbotron"  style="padding:40px; background-color:#24c88a;">
      <p>This is a simple site for lab management</p>
      <div class="custom-file-upload">
        <textarea  id="content" title="Paste your file content here.. " style="height: 243px; background-color:teal;">Past your file content here ...</textarea>
        <a href="#" id="uploadfile" class="btn btn-primary btn-lg" style="margin-left:50px;">upload</a>
        <span id="error-messagge">Error messagges here..</span>
      </div>
    </div>
    <div id="labm_about" class="jumbotron about"  style="padding:40px; display:none;  background-color:teal;">
      <h1>Labs</h1>



      <div id="container">
        <div class="drop-shadow raised">
          <p>Raised box</p>
        </div>

        <div class="drop-shadow curved v1">
          <p>Single vertical curve</p>
        </div>

        <div class="drop-shadow curved v2">
          <p>Vertical curves</p>
        </div>
      </div>
      <span id="li_refreshh" class="btn btn-normal ui-icon  ui-icon-refresh">Refreshh..</span>
      <table class="rwd-table highlight responsive-table">
        <tr>
          <th>Server Name</th>
          <th>Server Location</th>
          <th>Server IP</th>
          <th>Serial Number</th>
          <th>Owner Group</th>
          <th>Project Name</th>
          <th>End Date</th>
          <th>Admin Name</th>
          <th>Admin Password</th>
        </tr>
      </table>
      <div class="fixed-action-btn horizontal">
        <a class="btn-floating btn-large red">
          <i class="large material-icons">mode_edit</i>
        </a>
        <ul>
          <li><a class="btn-floating red"><i class="material-icons">insert_chart</i></a></li>
          <li><a class="btn-floating yellow darken-1"><i class="material-icons">format_quote</i></a></li>
          <li><a class="btn-floating green"><i class="material-icons">publish</i></a></li>
          <li><a class="btn-floating blue"><i class="material-icons">attach_file</i></a></li>
        </ul>
      </div>
    </div>
    <div id="labm_sitemap" class="jumbotron sitemap"  style="padding:40px; display:none; background-color:#24c88a;">
      <h1>Labs</h1>
      <p>site map of this tool</p>
      <p><a class="btn btn-lg" href="#" role="button">Learn more</a></p>
    </div>
  </div>
</body>
</html>
